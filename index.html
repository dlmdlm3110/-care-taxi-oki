
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>介護タクシー位置共有アプリ</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#3B82F6">
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            user-select: none;
            -webkit-user-select: none;
            -webkit-touch-callout: none;
        }
        
        .step-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: white;
            margin: 0 10px;
        }
        
        .step-active {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .step-completed {
            background: linear-gradient(135deg, #10B981, #059669);
        }
        
        .step-inactive {
            background: #9CA3AF;
        }
        
        .input-field {
            font-size: 18px;
            padding: 20px;
            border: 3px solid #E5E7EB;
            border-radius: 12px;
            width: 100%;
            transition: all 0.3s ease;
        }
        
        .input-field:focus {
            border-color: #3B82F6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3B82F6, #1D4ED8);
            color: white;
            font-size: 20px;
            font-weight: bold;
            padding: 20px 40px;
            border: none;
            border-radius: 12px;
            width: 100%;
            min-height: 70px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #EF4444, #DC2626);
            color: white;
            font-size: 18px;
            font-weight: bold;
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
            min-height: 60px;
        }
        
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(239, 68, 68, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #F59E0B, #D97706);
            color: white;
            font-size: 16px;
            font-weight: bold;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(245, 158, 11, 0.3);
            min-height: 50px;
        }
        
        .btn-secondary:hover {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(245, 158, 11, 0.4);
        }
        
        #map {
            width: 100%;
            height: 100vh;
            border-radius: 0;
        }
        
        .map-container {
            position: relative;
            width: 100%;
            height: 100vh;
        }
        
        .control-panel {
            position: fixed;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            z-index: 1000;
        }
        
        .timer-display {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(59, 130, 246, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3);
            z-index: 1000;
        }
        
        .status-info {
            background: rgba(16, 185, 129, 0.1);
            border: 2px solid #10B981;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 2px solid #EF4444;
            color: #DC2626;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            font-size: 16px;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        @media (max-width: 768px) {
            .control-panel {
                bottom: 10px;
                left: 10px;
                right: 10px;
                padding: 15px;
            }
            
            .timer-display {
                top: 10px;
                right: 10px;
                padding: 10px 15px;
                font-size: 16px;
            }
            
            .step-circle {
                width: 50px;
                height: 50px;
                font-size: 20px;
            }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-cyan-50 min-h-screen">
    <!-- Step 1: Location Permission -->
    <div id="step1" class="container mx-auto px-6 py-8 max-w-md">
        <div class="text-center mb-8">
            <div class="flex justify-center mb-6">
                <div class="step-circle step-active">1</div>
                <div class="step-circle step-inactive">2</div>
                <div class="step-circle step-inactive">3</div>
            </div>
            <div class="text-6xl mb-4">📍</div>
            <h1 class="text-2xl font-bold text-gray-800 mb-4">位置情報の許可</h1>
            <p class="text-gray-600 mb-8">位置情報を共有するために、ブラウザの位置情報アクセスを許可してください</p>
        </div>
        
        <button id="requestLocationBtn" class="btn-primary">
            <i class="fas fa-map-marker-alt mr-3"></i>
            位置情報を許可する
        </button>
        
        <div id="locationError" class="error-message hidden">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            <div id="locationErrorText">位置情報の取得に失敗しました</div>
        </div>
    </div>

    <!-- Step 2: Company Information -->
    <div id="step2" class="container mx-auto px-6 py-8 max-w-md hidden">
        <div class="text-center mb-8">
            <div class="flex justify-center mb-6">
                <div class="step-circle step-completed">1</div>
                <div class="step-circle step-active">2</div>
                <div class="step-circle step-inactive">3</div>
            </div>
            <div class="text-6xl mb-4">👔</div>
            <h1 class="text-2xl font-bold text-gray-800 mb-4">事業者情報を入力</h1>
            <p class="text-gray-600 mb-8">会社名と電話番号を入力してください</p>
        </div>
        
        <form id="companyForm" class="space-y-6">
            <div>
                <label class="block text-lg font-semibold text-gray-700 mb-3">
                    <i class="fas fa-building mr-2"></i>会社名
                </label>
                <input type="text" id="companyName" class="input-field" placeholder="例：○○介護タクシー" required maxlength="30">
            </div>
            
            <div>
                <label class="block text-lg font-semibold text-gray-700 mb-3">
                    <i class="fas fa-phone mr-2"></i>電話番号
                </label>
                <input type="tel" id="phoneNumber" class="input-field" placeholder="090-1234-5678" required>
            </div>
            
            <button type="submit" class="btn-primary">
                <i class="fas fa-map mr-3"></i>
                地図に登録する
            </button>
        </form>
        
        <div id="registrationError" class="error-message hidden">
            <i class="fas fa-exclamation-triangle mr-2"></i>
            <div id="registrationErrorText">登録に失敗しました</div>
        </div>
    </div>

    <!-- Step 3: Map Display -->
    <div id="step3" class="hidden">
        <div class="map-container">
            <div id="map"></div>
            
            <div class="timer-display">
                <div id="timeRemaining">07:59:59</div>
                <div class="text-sm opacity-90">残り時間: 8時間後に自動削除されます</div>
            </div>
            
            <div class="control-panel">
                <div class="status-info">
                    <i class="fas fa-users text-green-600 mr-2"></i>
                    <span id="operatorCount">1台の介護タクシーが稼働中</span>
                    <div class="text-sm text-gray-600 mt-1">
                        <i class="fas fa-phone mr-1"></i>
                        マーカーをタップして電話発信
                    </div>
                </div>
                
                <div class="grid grid-cols-1 gap-3">
                    <button id="endOperationBtn" class="btn-danger">
                        <i class="fas fa-power-off mr-2"></i>
                        稼働終了
                    </button>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <button id="updateLocationBtn" class="btn-secondary">
                            <i class="fas fa-sync-alt mr-2"></i>
                            位置更新
                        </button>
                        <button id="deleteLocationBtn" class="btn-secondary">
                            <i class="fas fa-trash-alt mr-2"></i>
                            削除
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl p-8 text-center">
            <div class="loading mb-4 mx-auto"></div>
            <div class="text-lg font-semibold text-gray-700">処理中...</div>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            deleteDoc, 
            doc, 
            updateDoc,
            onSnapshot,
            query,
            where,
            serverTimestamp,
            Timestamp
        } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCJIGNkMZJr4pPvG2YMAx2QaySnD-LZZs",
            authDomain: "care-taxi-okinawa.firebaseapp.com",
            projectId: "care-taxi-okinawa",
            storageBucket: "care-taxi-okinawa.firebasestorage.app",
            messagingSenderId: "1052247620667",
            appId: "1:1052247620667:web:6ccf1f12f5ec6bf36f0f0"
        };

        // Initialize Firebase
        console.log('Firebase初期化開始');
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        console.log('Firebase初期化完了');

        class CareTaxiApp {
            constructor() {
                this.currentStep = 1;
                this.userLocation = null;
                this.map = null;
                this.markers = [];
                this.userDocId = null;
                this.unsubscribe = null;
                this.countdownTimer = null;
                this.expirationTime = null;
                
                this.init();
            }
            
            init() {
                console.log('アプリ初期化開始');
                this.setupEventListeners();
                this.setupBeforeUnloadHandler();
                this.showStep(1);
            }
            
            setupEventListeners() {
                // Step 1: Location request
                document.getElementById('requestLocationBtn').addEventListener('click', () => {
                    this.requestLocation();
                });
                
                // Step 2: Form submission
                document.getElementById('companyForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleRegistration();
                });
                
                // Phone number formatting
                document.getElementById('phoneNumber').addEventListener('input', this.formatPhoneNumber);
                
                // Map controls
                document.getElementById('updateLocationBtn').addEventListener('click', () => {
                    this.updateLocation();
                });
                
                document.getElementById('deleteLocationBtn').addEventListener('click', () => {
                    this.showDeleteConfirmation();
                });
                
                document.getElementById('endOperationBtn').addEventListener('click', () => {
                    this.showEndOperationConfirmation();
                });
            }
            
            setupBeforeUnloadHandler() {
                // ブラウザ閉鎖時の自動削除
                window.addEventListener('beforeunload', (e) => {
                    console.log('beforeunload: 自動削除実行');
                    if (this.userDocId) {
                        this.deleteLocationSync();
                    }
                });
                
                window.addEventListener('unload', () => {
                    console.log('unload: 自動削除実行');
                    if (this.userDocId) {
                        this.deleteLocationSync();
                    }
                });
                
                document.addEventListener('visibilitychange', () => {
                    if (document.visibilityState === 'hidden' && this.userDocId) {
                        console.log('visibilitychange: 自動削除実行');
                        this.deleteLocationSync();
                    }
                });
            }
            
            deleteLocationSync() {
                // 同期的な削除（navigator.sendBeacon使用）
                if (navigator.sendBeacon && this.userDocId) {
                    const deleteUrl = `https://firestore.googleapis.com/v1/projects/care-taxi-okinawa/databases/(default)/documents/care_taxi_locations/${this.userDocId}`;
                    navigator.sendBeacon(deleteUrl, JSON.stringify({ method: 'DELETE' }));
                }
            }
            
            async requestLocation() {
                const btn = document.getElementById('requestLocationBtn');
                const errorDiv = document.getElementById('locationError');
                
                btn.disabled = true;
                btn.innerHTML = '<div class="loading mr-3"></div>位置情報を取得中...';
                errorDiv.classList.add('hidden');
                
                try {
                    const position = await this.getCurrentPosition();
                    this.userLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    console.log('位置情報取得成功:', this.userLocation);
                    this.showStep(2);
                } catch (error) {
                    console.error('位置情報取得エラー:', error);
                    this.showError('locationError', 'locationErrorText', '位置情報の取得に失敗しました。ブラウザの設定を確認してください。');
                } finally {
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-map-marker-alt mr-3"></i>位置情報を許可する';
                }
            }
            
            getCurrentPosition() {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) {
                        reject(new Error('位置情報がサポートされていません'));
                        return;
                    }
                    
                    navigator.geolocation.getCurrentPosition(
                        resolve,
                        reject,
                        {
                            enableHighAccuracy: true,
                            timeout: 15000,
                            maximumAge: 300000
                        }
                    );
                });
            }
            
            formatPhoneNumber(event) {
                let value = event.target.value.replace(/\D/g, '');
                if (value.length >= 7) {
                    value = value.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
                } else if (value.length >= 4) {
                    value = value.replace(/(\d{3})(\d{1,4})/, '$1-$2');
                }
                event.target.value = value;
            }
            
            async handleRegistration() {
                const companyName = document.getElementById('companyName').value.trim();
                const phoneNumber = document.getElementById('phoneNumber').value.trim();
                
                if (!companyName || !phoneNumber) {
                    this.showError('registrationError', 'registrationErrorText', '会社名と電話番号を入力してください');
                    return;
                }
                
                if (!this.userLocation) {
                    this.showError('registrationError', 'registrationErrorText', '位置情報を取得できませんでした');
                    return;
                }
                
                this.showLoading(true);
                
                try {
                    console.log('事業者登録開始');
                    const now = new Date();
                    const expiresAt = new Date(now.getTime() + 8 * 60 * 60 * 1000); // 8時間後
                    
                    const docData = {
                        company_name: companyName,
                        phone_number: phoneNumber,
                        latitude: this.userLocation.lat,
                        longitude: this.userLocation.lng,
                        created_at: serverTimestamp(),
                        expires_at: Timestamp.fromDate(expiresAt)
                    };
                    
                    console.log('Firestoreにデータ保存中:', docData);
                    const docRef = await addDoc(collection(db, 'care_taxi_locations'), docData);
                    this.userDocId = docRef.id;
                    this.expirationTime = expiresAt;
                    
                    console.log('データ保存完了:', this.userDocId);
                    
                    this.showStep(3);
                    await this.initializeMap();
                    this.startCountdownTimer();
                    this.subscribeToLocations();
                    
                } catch (error) {
                    console.error('登録エラー:', error);
                    this.showError('registrationError', 'registrationErrorText', '登録に失敗しました: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }
            
            async initializeMap() {
                console.log('地図初期化開始');
                
                return new Promise((resolve) => {
                    this.map = new google.maps.Map(document.getElementById('map'), {
                        center: this.userLocation || { lat: 26.2124, lng: 127.6792 }, // 沖縄県那覇市
                        zoom: 11,
                        mapTypeControl: false,
                        streetViewControl: false,
                        fullscreenControl: false,
                        styles: [
                            {
                                featureType: 'poi',
                                elementType: 'labels',
                                stylers: [{ visibility: 'off' }]
                            }
                        ]
                    });
                    
                    console.log('地図初期化完了');
                    
                    // 地図の読み込み完了を待つ
                    google.maps.event.addListenerOnce(this.map, 'idle', () => {
                        console.log('地図読み込み完了');
                        resolve();
                    });
                });
            }
            
            subscribeToLocations() {
                console.log('Firestore監視開始');
                
                try {
                    const locationsRef = collection(db, 'care_taxi_locations');
                    const now = new Date();
                    const q = query(locationsRef, where('expires_at', '>', Timestamp.fromDate(now)));
                    
                    this.unsubscribe = onSnapshot(q, (snapshot) => {
                        console.log(`Firestoreデータ取得: ${snapshot.docs.length}件`);
                        this.updateMarkers(snapshot.docs);
                        this.updateOperatorCount(snapshot.docs.length);
                    }, (error) => {
                        console.error('Firestore監視エラー:', error);
                    });
                    
                } catch (error) {
                    console.error('Firestore監視設定エラー:', error);
                }
            }
            
            updateMarkers(docs) {
                console.log('マーカー更新開始');
                
                // 既存のマーカーをクリア
                this.markers.forEach(marker => {
                    marker.setMap(null);
                });
                this.markers = [];
                
                // 新しいマーカーを作成
                docs.forEach(doc => {
                    const data = doc.data();
                    const isCurrentUser = doc.id === this.userDocId;
                    
                    console.log(`マーカー作成: ${data.company_name} at (${data.latitude}, ${data.longitude})`);
                    
                    const marker = new google.maps.Marker({
                        position: { 
                            lat: Number(data.latitude), 
                            lng: Number(data.longitude) 
                        },
                        map: this.map,
                        title: data.company_name,
                        icon: {
                            url: isCurrentUser ? 
                                'https://maps.google.com/mapfiles/ms/icons/red-dot.png' :
                                'https://maps.google.com/mapfiles/ms/icons/blue-dot.png',
                            scaledSize: new google.maps.Size(32, 32)
                        }
                    });
                    
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="padding: 15px; min-width: 200px; text-align: center;">
                                <h3 style="margin: 0 0 10px 0; font-size: 18px; font-weight: bold;">${data.company_name}</h3>
                                <p style="margin: 10px 0;">
                                    <a href="tel:${data.phone_number}" 
                                       style="color: #3B82F6; text-decoration: none; font-size: 20px; font-weight: bold; display: block; padding: 10px; background: #F3F4F6; border-radius: 8px;">
                                        <i class="fas fa-phone"></i> ${data.phone_number}
                                    </a>
                                </p>
                                <small style="color: #6B7280;">タップで電話をかけます</small>
                            </div>
                        `
                    });
                    
                    marker.addListener('click', () => {
                        infoWindow.open(this.map, marker);
                    });
                    
                    this.markers.push(marker);
                });
                
                console.log(`マーカー作成完了: ${this.markers.length}個`);
            }
            
            updateOperatorCount(count) {
                const countElement = document.getElementById('operatorCount');
                if (countElement) {
                    countElement.textContent = `${count}台の介護タクシーが稼働中`;
                }
            }
            
            startCountdownTimer() {
                if (this.countdownTimer) {
                    clearInterval(this.countdownTimer);
                }
                
                this.countdownTimer = setInterval(() => {
                    if (!this.expirationTime) return;
                    
                    const now = new Date();
                    const remaining = this.expirationTime.getTime() - now.getTime();
                    
                    if (remaining <= 0) {
                        this.handleExpiration();
                        return;
                    }
                    
                    const hours = Math.floor(remaining / (1000 * 60 * 60));
                    const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                    const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                    
                    const timeElement = document.getElementById('timeRemaining');
                    if (timeElement) {
                        timeElement.textContent = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                    }
                }, 1000);
            }
            
            handleExpiration() {
                if (this.countdownTimer) {
                    clearInterval(this.countdownTimer);
                }
                
                alert('8時間が経過しました。位置情報が自動削除されます。');
                this.deleteLocation();
            }
            
            async updateLocation() {
                try {
                    this.showLoading(true);
                    const position = await this.getCurrentPosition();
                    
                    const newLocation = {
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    };
                    
                    if (this.userDocId) {
                        await updateDoc(doc(db, 'care_taxi_locations', this.userDocId), {
                            latitude: newLocation.lat,
                            longitude: newLocation.lng
                        });
                        
                        this.userLocation = newLocation;
                        this.map.setCenter(newLocation);
                        
                        alert('位置情報を更新しました');
                    }
                } catch (error) {
                    console.error('位置更新エラー:', error);
                    alert('位置情報の更新に失敗しました');
                } finally {
                    this.showLoading(false);
                }
            }
            
            showDeleteConfirmation() {
                if (confirm('位置情報を削除しますか？')) {
                    this.deleteLocation();
                }
            }
            
            showEndOperationConfirmation() {
                if (confirm('稼働を終了しますか？\n位置情報が地図から削除されます。')) {
                    this.deleteLocation();
                }
            }
            
            async deleteLocation() {
                if (!this.userDocId) return;
                
                try {
                    this.showLoading(true);
                    
                    await deleteDoc(doc(db, 'care_taxi_locations', this.userDocId));
                    
                    if (this.unsubscribe) {
                        this.unsubscribe();
                    }
                    
                    if (this.countdownTimer) {
                        clearInterval(this.countdownTimer);
                    }
                    
                    alert('位置情報を削除しました。稼働を終了します。');
                    
                    // アプリを初期状態に戻す
                    this.userDocId = null;
                    this.expirationTime = null;
                    this.showStep(1);
                    
                } catch (error) {
                    console.error('削除エラー:', error);
                    alert('削除に失敗しました: ' + error.message);
                } finally {
                    this.showLoading(false);
                }
            }
            
            showStep(step) {
                document.querySelectorAll('[id^="step"]').forEach(el => {
                    el.classList.add('hidden');
                });
                
                const stepElement = document.getElementById(`step${step}`);
                if (stepElement) {
                    stepElement.classList.remove('hidden');
                    stepElement.classList.add('fade-in');
                }
                
                this.currentStep = step;
            }
            
            showError(containerId, textId, message) {
                const container = document.getElementById(containerId);
                const textElement = document.getElementById(textId);
                
                if (container && textElement) {
                    textElement.textContent = message;
                    container.classList.remove('hidden');
                }
            }
            
            showLoading(show) {
                const overlay = document.getElementById('loadingOverlay');
                if (overlay) {
                    if (show) {
                        overlay.classList.remove('hidden');
                    } else {
                        overlay.classList.add('hidden');
                    }
                }
            }
        }

        // Initialize app when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            console.log('DOM読み込み完了、アプリ開始');
            window.careTaxiApp = new CareTaxiApp();
        });
    </script>

    <!-- Google Maps API -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA8NRDN9NszAV2vnMbhej2Vh-bpqDxCuqU&libraries=geometry"></script>
</body>
</html>
    <script id="html_badge_script1">
        window.__genspark_remove_badge_link = "https://www.genspark.ai/api/html_badge/" +
            "remove_badge?token=To%2FBnjzloZ3UfQdcSaYfDi38QtLzTzNsQhPoBL25dCft%2BK4ta3caUWEEXr8ykoM5Eq1Wdr%2BB%2B7tzccoc1%2B%2BNOjnk6bpyO9f6F6Cl2d2PfXHjiEX26KU5eyb28P3s1NOjOAz1PK8T7fou9UNC94SFqF4riVA2itbX0W0c%2FmkIbN9EwR8byEAiPj9OhSOoMqwS7p42OuGgOhpsZULS9Cfw7dn%2BnCAUlJhlci4f4pD6roi8el9jT0ClQQF4vBM8mD5jYWIBhFoVupXkFN%2F6lOWbHyNPa0v%2BXoD33%2FRusC%2BRwkb4dYGictrikNFuUmjZvWc1S%2FIRJ6sHqTXFtcu%2F0vWNYYucBLKdB3EHdCshEh1NMCUIrlMbXF1GXV2SmAOYsT3Ehw2%2B46oHZcPm%2BD5UEvIkCnmFwugb0VsP7Vyu9GcfOmPGngrOVfmojKOZ0%2FGJgxPV6XJ1yjcy5Z13VFVLNtJ5VLAUjgUMczyX9B8z9oo1Zt%2Bv0jfB78ROuQwAiGZ5lYBxH8qOr2LXEduynCk1X%2FdTHYqeiI9ck9BL88SMzBDvvcM%3D";
        window.__genspark_locale = "ja-JP";
        window.__genspark_token = "To/BnjzloZ3UfQdcSaYfDi38QtLzTzNsQhPoBL25dCft+K4ta3caUWEEXr8ykoM5Eq1Wdr+B+7tzccoc1++NOjnk6bpyO9f6F6Cl2d2PfXHjiEX26KU5eyb28P3s1NOjOAz1PK8T7fou9UNC94SFqF4riVA2itbX0W0c/mkIbN9EwR8byEAiPj9OhSOoMqwS7p42OuGgOhpsZULS9Cfw7dn+nCAUlJhlci4f4pD6roi8el9jT0ClQQF4vBM8mD5jYWIBhFoVupXkFN/6lOWbHyNPa0v+XoD33/RusC+Rwkb4dYGictrikNFuUmjZvWc1S/IRJ6sHqTXFtcu/0vWNYYucBLKdB3EHdCshEh1NMCUIrlMbXF1GXV2SmAOYsT3Ehw2+46oHZcPm+D5UEvIkCnmFwugb0VsP7Vyu9GcfOmPGngrOVfmojKOZ0/GJgxPV6XJ1yjcy5Z13VFVLNtJ5VLAUjgUMczyX9B8z9oo1Zt+v0jfB78ROuQwAiGZ5lYBxH8qOr2LXEduynCk1X/dTHYqeiI9ck9BL88SMzBDvvcM=";
    </script>
    
    <script id="html_notice_dialog_script" src="https://www.genspark.ai/notice_dialog.js"></script>
    
